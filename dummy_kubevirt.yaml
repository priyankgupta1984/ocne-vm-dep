- name: Create KubeVirt VM with kubectl apply
  hosts: 10.178.73.51
  vars:
    ansible_python_interpreter: /usr/bin/python3.11
  collections:
    - kubernetes.core
  tasks:
    - name: Create virtual machine 'myvm-ansible' and start it
      k8s:
        state: running
        definition:
          apiVersion: kubevirt.io/v1
          kind: VirtualMachine
          metadata:
            name: myvm-ansible
            namespace: default
          spec:
            running: true
            template:
              spec:
                architecture: amd64
                domain:
                  devices:
                    disks:
                      - disk:
                          bus: virtio
                        name: containerdisk
                    interfaces:
                      - masquerade: {}
                        name: default
                        ports:
                          - port: 80
                  features:
                    acpi: {}
                    smm:
                      enabled: true
                  firmware:
                    bootloader: {}
                  machine:
                    type: q35
                  resources:
                    requests:
                      memory: 2048M
                evictionStrategy: LiveMigrate
                networks:
                  - name: default
                    pod: {}
                terminationGracePeriodSeconds: 30
                volumes:
                  - containerDisk:
                      image: ghcr.io/priyankgupta1984/fedora-img/fedora:latest
                    name: containerdisk
        kubeconfig: /root/.kube/kubeconfig.odscocne
